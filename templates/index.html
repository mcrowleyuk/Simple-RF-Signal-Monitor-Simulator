<!DOCTYPE html>
<html>
<head>
    <title>RF Signal Monitor</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>RF Signal Strength Monitor (Simulation)</h1>

    <p>Signal Strength: <span id="strength">...</span> dBm</p>
    <p>Frequency: <span id="frequency">...</span> MHz</p>
    <p>Last Updated: <span id="timestamp">...</span></p>
    <button onclick="refreshData()">Refresh RF Data</button>

    <button onclick="warnedYou()">Don't Click This Button</button>

    <canvas id="rfChart" width="600" height="300"></canvas>

    <script>

        let bWarned = false;
        let refreshInterval;

        const ctx = document.getElementById('rfChart').getContext('2d');
        const rfChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Signal Strength (dBm)',
                    data: [],
                    borderColor: 'blue',
                    fill: false
                }]
            },
            options: {
                scales: {
                    x: {
                        title: { display: true, text: 'Time' }
                    },
                    y: {
                        title: { display: true, text: 'dBm' },
                        min: -100,
                        max: -50
                    }
                }
            }
        });

        function refreshData() {
            fetch('/rf') // sends an HTTP GET request  to /rf route of Flask App
                .then(res => res.json()) // convert back to JSO
                .then(data => {
                    const now = new Date().toLocaleTimeString();
                    document.getElementById('strength').textContent = data.signal_strength;
                    document.getElementById('frequency').textContent = data.frequency;
                    document.getElementById('timestamp').textContent = now;

                    // Update chart
                    rfChart.data.labels.push(now);
                    rfChart.data.datasets[0].data.push(parseInt(data.signal_strength)); 
                    rfChart.data.datasets[1].data.push(parseInt(data.frequency)); 
                    rfChart.update();


                    // TEST
                    clearInterval(refreshInterval);

                    // Start fast refresh
                    refreshInterval = setInterval(refreshData, 10);
                    refreshData();

                });
        }

        function warnedYou() {
            alert("Commencing Frequency Jamming - no turning back!");
            bWarned = true;

            // Clear previous interval
            clearInterval(refreshInterval);

            // Start fast refresh
            refreshInterval = setInterval(refreshData, 10);
            refreshData();

            }


        // Load initial data and refresh every 5 seconds
        refreshData();
        if (!bWarned)
            setInterval(refreshData, 5000);
        else
            setInterval(refreshData, 10); // won't get to here
    </script>
</body>
</html>
